name: CI

on: [push, pull_request]

jobs:
  format:
    runs-on: ubuntu-22.04
    steps:
    - uses: actions/checkout@v4
    - run: pip3 install black
    - run: python3 -m black .
    - run: git --no-pager diff --exit-code HEAD

  export:
    runs-on: ubuntu-22.04
    steps:
    - uses: actions/checkout@v4
    - name: Install inkscape and imagemagick
      run: |
        sudo add-apt-repository ppa:inkscape.dev/stable
        sudo apt-get update -q
        sudo apt-get install inkscape imagemagick -y
    - run: ./export.py
    # Ignore .svg files because Ubuntu 22.04 inkscape has round-off issues and
    # .ico files because Ubuntu 22.04 ImageMagick gives different results
    - run: git --no-pager diff --exit-code HEAD -- . ':!export/ico' ':!export/svg'
